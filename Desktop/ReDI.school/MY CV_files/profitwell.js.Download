!function(){"use strict";var t=function(){function t(){}return t.prototype.trackAnonymousCustomer=function(){},t.prototype.getAnonymousId=function(){return null},t}(),e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,r)};
/*! *****************************************************************************
    Copyright (c) Microsoft Corporation. All rights reserved.
    Licensed under the Apache License, Version 2.0 (the "License"); you may not use
    this file except in compliance with the License. You may obtain a copy of the
    License at http://www.apache.org/licenses/LICENSE-2.0

    THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
    KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
    WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
    MERCHANTABLITY OR NON-INFRINGEMENT.

    See the Apache Version 2.0 License for specific language governing permissions
    and limitations under the License.
    ***************************************************************************** */var r=function(){return(r=Object.assign||function(t){for(var e,r=1,i=arguments.length;r<i;r++)for(var n in e=arguments[r])Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t}).apply(this,arguments)};function i(t,e,r,i){return new(r||(r=Promise))((function(n,o){function s(t){try{u(i.next(t))}catch(t){o(t)}}function a(t){try{u(i.throw(t))}catch(t){o(t)}}function u(t){t.done?n(t.value):new r((function(e){e(t.value)})).then(s,a)}u((i=i.apply(t,e||[])).next())}))}function n(t,e){var r,i,n,o,s={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return o={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(o){return function(a){return function(o){if(r)throw new TypeError("Generator is already executing.");for(;s;)try{if(r=1,i&&(n=2&o[0]?i.return:o[0]?i.throw||((n=i.return)&&n.call(i),0):i.next)&&!(n=n.call(i,o[1])).done)return n;switch(i=0,n&&(o=[2&o[0],n.value]),o[0]){case 0:case 1:n=o;break;case 4:return s.label++,{value:o[1],done:!1};case 5:s.label++,i=o[1],o=[0];continue;case 7:o=s.ops.pop(),s.trys.pop();continue;default:if(!(n=s.trys,(n=n.length>0&&n[n.length-1])||6!==o[0]&&2!==o[0])){s=0;continue}if(3===o[0]&&(!n||o[1]>n[0]&&o[1]<n[3])){s.label=o[1];break}if(6===o[0]&&s.label<n[1]){s.label=n[1],n=o;break}if(n&&s.label<n[2]){s.label=n[2],s.ops.push(o);break}n[2]&&s.ops.pop(),s.trys.pop();continue}o=e.call(t,s)}catch(t){o=[6,t],i=0}finally{r=n=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,a])}}}function o(){for(var t=0,e=0,r=arguments.length;e<r;e++)t+=arguments[e].length;var i=Array(t),n=0;for(e=0;e<r;e++)for(var o=arguments[e],s=0,a=o.length;s<a;s++,n++)i[n]=o[s];return i}var s="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};var a,u=(function(t,e){var r=s&&s.__extends||function(){var t=function(e,r){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(e,r)};return function(e,r){function i(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(i.prototype=r.prototype,new i)}}();Object.defineProperty(e,"__esModule",{value:!0}),function(t){t.unreachableCode="unreachableCode"}(e.CommonErrorReasons||(e.CommonErrorReasons={}));var i=function(t){function e(e){var r=this.constructor,i=t.call(this,e)||this;return Object.setPrototypeOf(i,r.prototype),i}return r(e,t),e}(Error);e.CustomError=i;var n=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return r(e,t),e}(i);e.InvalidArgumentError=n;var o=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return r(e,t),e}(i);e.InvalidStateError=o;var a=function(t){function e(){return t.call(this,"Unexpected nil value")||this}return r(e,t),e}(i);function u(t){throw new Error(t)}e.UnexpectedNilError=a,e.fail=u,e.assertUnreachable=function(t,e){return u(t+e)}}(a={exports:{}},a.exports),a.exports),c=u.fail,l=u.CommonErrorReasons,d=u.CustomError,h=u.InvalidArgumentError,p=u.InvalidStateError,f=u.UnexpectedNilError,m=u.assertUnreachable,y=Object.defineProperty({fail:c,CommonErrorReasons:l,CustomError:d,InvalidArgumentError:h,InvalidStateError:p,UnexpectedNilError:f,assertUnreachable:m},"__esModule",{value:!0});function v(t){return null==t}var g=v;var w=function(t){return!v(t)};var b=function(t,e){if(!t){var r=S(e,"Invalid argument");throw new y.InvalidArgumentError(r)}};var U=function(t,e){if(!t){var r=S(e,"Invalid state");throw new y.InvalidStateError(r)}};var _=function(t,e){if(v(t)){if(v(e))throw new y.UnexpectedNilError;return y.fail(e)}return t};function S(t,e){return v(t)?e:t}var P=S;var E=function(t,e){if(!(t in e))throw new TypeError("Missing key "+t)};var k=function(t){if("number"!=typeof t)throw new TypeError("Value is not a number")};var A=function(t){if("string"!=typeof t)throw new TypeError("Value is not a string")};var C=function(t){if(!Array.isArray(t))throw new TypeError("Value is not an array")};var T=function(t){if("boolean"!=typeof t)throw new TypeError("Value is not a boolean")};var I=function(t){return""===t.trim()};var D=function(t){return/^(([^<>()[\]\\.,;:\s@"]+(\.[^<>()[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(t)};var O,F,R=function(t,e){return Object.values(e).includes(t)},N=Object.defineProperty({isNil:g,isNotNil:w,checkArgument:b,checkState:U,checkNotNil:_,getValueOrDefault:P,checkWithKey:E,checkNumber:k,checkString:A,checkArray:C,checkBoolean:T,isStringEmpty:I,isValidEmail:D,isEnumMember:R},"__esModule",{value:!0}),q=N.isNil,B=N.isNotNil,Q=(N.checkArgument,N.checkState,N.checkNotNil),x=N.getValueOrDefault,L=(N.checkWithKey,N.checkNumber,N.checkString),V=(N.checkArray,N.checkBoolean,N.isStringEmpty,N.isValidEmail,N.isEnumMember,{emails:["user@email.com","$replace_with_email_of_current_use","replace_with_email_of_current_use","$user_email"],userIds:["some_user_id"],authTokens:["","{YOUR_PROFITWELL_TOKEN_HERE}","YOUR_PROFITWELL_TOKEN_HERE","PUBLIC_API_TOKEN_HERE"]});!function(t){t.anonymousId="__pw-aid",t.testingKey="__pw-test"}(O||(O={})),function(t){t.anonymousId="anonymous_id",t.docReferrer="doc_referrer"}(F||(F={}));var z,H,J;!function(t){t.dunning="dunning",t.extendTrial="extend_trial",t.planUpgrade="plan_upgrade",t.termOptimization="term_optimization",t.reactivation="reactivation",t.reactivationUnsubscribe="reactivation_unsubscribe",t.planUpgradeUnsubscribe="plan_upgrade_unsubscribe",t.updateCard="update_card"}(z||(z={})),function(t){t.accepted="accepted",t.rejected="rejected",t.notOffered="not_offered",t.error="error"}(H||(H={})),function(t){t.error="error",t.aborted="aborted",t.chose_to_cancel="chose_to_cancel",t.retained="retained"}(J||(J={}));var j=function(t){function r(e,r){void 0===r&&(r="Detail not available");var i=t.call(this,e.statusText+" (status: "+e.status+", url: "+e.url+") - "+r+".")||this;return i.response=e,i.detail=r,i.name="FetchError",i}return function(t,r){function i(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(i.prototype=r.prototype,new i)}(r,t),r}(Error),W=function(){function t(t){this.credentials=t}return t.prototype.get=function(t,e){return void 0!==e&&(t=t+"?"+this.encodeURLParams(e)),this.request(t,{method:"GET"})},t.prototype.postUrlEncoded=function(t,e){var r={method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"}};return void 0!==e&&(r.body=this.encodeURLParams(e)),this.request(t,r)},t.prototype.postJson=function(t,e){var r={method:"POST",headers:{"Content-Type":"application/json"}};return void 0!==e&&(r.body=JSON.stringify(e)),this.request(t,r)},t.prototype.request=function(t,e){return i(this,void 0,void 0,(function(){var r,i;return n(this,(function(n){switch(n.label){case 0:return this.addAuthorizationHeader(e),[4,fetch(t,e)];case 1:return(r=n.sent()).ok?[3,3]:[4,this.parseErrorDetailFromResponse(r)];case 2:throw i=n.sent(),new j(r,i);case 3:return[2,this.parseSuccessfulResponse(r)]}}))}))},t.prototype.parseErrorDetailFromResponse=function(t){return i(this,void 0,void 0,(function(){return n(this,(function(e){switch(e.label){case 0:return e.trys.push([0,2,,3]),[4,t.json()];case 1:return[2,e.sent().detail];case 2:return e.sent(),[2,void 0];case 3:return[2]}}))}))},t.prototype.parseSuccessfulResponse=function(t){var e;return(null!==(e=t.headers.get("Content-Type"))&&void 0!==e?e:"").includes("json")?t.json():t.text()},t.prototype.addAuthorizationHeader=function(t){this.credentials.isAuthTokenValid()&&(t.headers=r(r({},t.headers),{Authorization:this.credentials.getAuthToken()}))},t.prototype.encodeURLParams=function(t){return new URLSearchParams(t).toString()},t}();function K(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]}var M=function(){function t(t,e,r,o,s,a,u,c,l,d,h){var p=this;this.urlBuilder=t,this.credentials=e,this.requests=r,this.customerIdentity=o,this.urlTracker=s,this.anonymousTracker=a,this.urlChangeListener=u,this.widgetService=c,this.customStyles=l,this.notificationFetcher=d,this.messageService=h,this.isAlreadyStarted=!1,this.onPaymentRecoveryCallback=K,this.maybeFetchNotificationAndTrackCurrentUrl=function(){return i(p,void 0,void 0,(function(){var t;return n(this,(function(e){switch(e.label){case 0:return this.hasAnyPWQueryParam()?[2]:this.urlTracker.maybeSetCurrentUrlAsTracked()?[4,this._fetchNotificationAndTrackCurrentUrl()]:[2];case 1:return(t=e.sent()).isEmpty||this.widgetService.loadSameOriginIFrame(t.data),[2]}}))}))}}return t.prototype.dump=function(){return{retain_url:this.urlBuilder.getRetainUrl(),sensing_url:this.urlBuilder.getSensingUrl(),is_url_change_tracking_enabled:this.urlChangeListener.isEnabled,is_already_started:this.isAlreadyStarted,auth_token:this.credentials.getAuthToken(),customer_credentials:this.getCustomerParamsWithAnonymousId()}},t.prototype.auth_token=function(t){return this.setAuthToken(t),t},t.prototype.pw_url=function(t){this.urlBuilder.setRetainUrl(t),this.urlBuilder.setSensingUrl(t)},t.prototype.user_email=function(t){return this.customerIdentity.setEmail(t),this.urlTracker.reset(),this.triggerUserRequiredActions(),t},t.prototype.user_id=function(t){return this.setUserId(t),t},t.prototype.user_stripe_id=function(t){return this.setUserId(t),t},t.prototype.on_load=function(){this.hasDunningQueryParamFromEmail()?this.loadDunningFromEmailLink():this.hasDunningQueryParamFromSms()?this.loadDunningFromSmsLink():this.hasEncodedPWQueryParam()?this.loadActivityOrPreview():this.hasAdHocQueryParams()&&this.loadAdHocActivity()},t.prototype.start=function(t){this.checkStartRunsOnce()&&(this.execStartCommands(t),this.shouldTrackCustomerAsAnonymous()&&this.anonymousTracker.trackAnonymousCustomer())},t.prototype.events=function(t){this.onPaymentRecoveryCallback=t.on_payment_recovered},t.prototype.payment_recovered=function(){try{this.onPaymentRecoveryCallback()}catch(t){console.warn("Something went wrong calling the payment recovered event callback")}},t.prototype.send_error=function(t){var e=this.urlBuilder.buildSendErrorUrl();this.requests.postUrlEncoded(e,r({error:t},this.getCustomerParams()))},t.prototype.get_param=function(t){var e=window.location.href,r=t.replace(/[\[\]]/g,"\\$&"),i=new RegExp("[?&]"+r+"(=([^&#]*)|&|#|$)").exec(e);if(q(i))return null;var n=i[2];return q(n)||""===n?"":decodeURIComponent(n.replace(/\+/g," "))},t.prototype.cq_get=function(){this.maybeFetchNotificationAndTrackCurrentUrl()},t.prototype.cq_snooze=function(t){this.postNotificationCommand({action:"snooze",uuid:t})},t.prototype.cq_dismiss=function(t){this.postNotificationCommand({action:"dismiss",uuid:t})},t.prototype.cq_resolve=function(t,e,r){return i(this,void 0,void 0,(function(){var i,o;return n(this,(function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),[4,this.postNotificationCommand({action:"resolve",uuid:t,data:JSON.stringify(e)})];case 1:return i=n.sent(),[3,3];case 2:if((o=n.sent())instanceof j)return r(o.detail),[2];throw o;case 3:return r(i),[2]}}))}))},t.prototype.cq_demo=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return i(this,void 0,void 0,(function(){var e,i;return n(this,(function(n){switch(n.label){case 0:return e=r({params:t.join(",")},this.customStyles.toParams()),[4,this.requests.get(this.getCqDemoUrl(t[0]),e)];case 1:return i=n.sent(),this.widgetService.loadSameOriginIFrame(i),[2]}}))}))},t.prototype.getCqDemoUrl=function(t){return"cancellation_flow"===t?this.urlBuilder.buildPreviewCancellationFlowUrl():this.urlBuilder.buildNotificationDemoUrl()},t.prototype.url_tracking=function(t){t||this.urlChangeListener.disable()},t.prototype.useFullScreenWidget=function(){this.widgetService.showFullScreen()},t.prototype.useNotificationWidget=function(t){void 0===t&&(t="350px"),this.widgetService.showNotification(t)},t.prototype.disposeWidget=function(){this.widgetService.hide()},t.prototype.show_cc_form=function(t){return i(this,void 0,void 0,(function(){var e,i,o;return n(this,(function(n){switch(n.label){case 0:return e=this.urlBuilder.buildCreditCardFormUrl(),i=r(r({},this.getCustomerParams()),this.customStyles.toParams()),[4,this.requests.get(e,i)];case 1:return o=n.sent(),this.widgetService.loadSameOriginIFrame(o,t),[2]}}))}))},t.prototype.confirmPlanUpgrade=function(t,e,r){return i(this,void 0,void 0,(function(){var i,o,s;return n(this,(function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),i=this.urlBuilder.buildTermOptimizationConfirmUpgradeUrl(t),[4,this.requests.postUrlEncoded(i)];case 1:return o=n.sent(),e(JSON.stringify(o)),[3,3];case 2:return s=n.sent(),r(s),[3,3];case 3:return[2]}}))}))},t.prototype.digestScriptDataAttributes=function(){var t=document.getElementById("profitwell-js");null!==t&&this.digestAuthDataAttribute(t)},t.prototype.styles=function(t){this.customStyles.setCustomStyles(t)},t.prototype.on_cancellation=function(){return i(this,void 0,void 0,(function(){var t,e,i,o=this;return n(this,(function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),t=this.urlBuilder.buildCreateSalvageOfferUrl(),[4,this.requests.postUrlEncoded(t,r(r({},this.getCustomerParams()),this.customStyles.toParams()))];case 1:return"error"===(e=n.sent()).status?[2,{status:H.error,details:"Server error"}]:e.data.has_offer?(i=e.data,[2,new Promise((function(t){o.widgetService.loadSameOriginIFrame(i.rendered_widget),o.messageService.addOneTimeListener("salvageOfferComplete",t)}))]):[2,{status:H.notOffered,details:e.data.reason}];case 2:return n.sent(),[2,{status:H.error,details:"Server error"}];case 3:return[2]}}))}))},t.prototype.init_cancellation_flow=function(t){return void 0===t&&(t={}),i(this,void 0,void 0,(function(){var e,i,o,s=this;return n(this,(function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),e=this.urlBuilder.buildCancellationFlowUrl(),[4,this.requests.get(e,r(r(r({},this.getCustomerParams()),t),this.customStyles.toParams()))];case 1:return"error"===(i=n.sent()).status?[2,{status:J.error,details:"Server error"}]:i.data.success?(o=i.data,[2,new Promise((function(t){s.widgetService.loadSameOriginIFrame(o.widget),s.messageService.addOneTimeListener("cancellationFlowComplete",t)}))]):[2,{status:J.error,details:i.data.reason}];case 2:return n.sent(),[2,{status:J.error,details:"Server error"}];case 3:return[2]}}))}))},t.prototype.setAuthToken=function(t){this.credentials.setAuthToken(t)&&this.urlTracker.reset()},t.prototype.checkStartRunsOnce=function(){return this.isAlreadyStarted?(console.warn("Discarded second start call: profitwell can't be started twice."),!1):(this.isAlreadyStarted=!0,!0)},t.prototype.execStartCommands=function(t){for(var e=t,r=0,i=Object.keys(e);r<i.length;r++){var n=i[r],o=e[n];this[n](o)}},t.prototype.shouldTrackCustomerAsAnonymous=function(){return this.credentials.isAuthTokenValid()&&!this.hasDunningQueryParamFromEmail()&&!this.customerIdentity.isValid()&&!this.hasDoNotTrackHeader()},t.prototype.hasDoNotTrackHeader=function(){return"1"===navigator.doNotTrack||"1"===window.doNotTrack},t.prototype._fetchNotificationAndTrackCurrentUrl=function(){return i(this,void 0,void 0,(function(){var t;return n(this,(function(e){switch(e.label){case 0:return e.trys.push([0,2,,3]),[4,this.notificationFetcher.fetchNotificationAndTrackCurrentUrl(r(r({},this.getCustomerParamsWithAnonymousId()),this.customStyles.toParams()))];case 1:return[2,e.sent()];case 2:return t=e.sent(),this.send_error(t.stack),[2,Promise.reject(t)];case 3:return[2]}}))}))},t.prototype.getCustomerParamsWithAnonymousId=function(){var t=this.getCustomerParams(),e=this.anonymousTracker.getAnonymousId();return q(e)?t:r(r({},t),{anonymous_id:e})},t.prototype.postNotificationCommand=function(t){return this.requests.postUrlEncoded(this.urlBuilder.buildNotificationUrl(),r(r({},t),this.getCustomerParams()))},t.prototype.loadDunning=function(t){return i(this,void 0,void 0,(function(){var e;return n(this,(function(r){switch(r.label){case 0:return[4,this.requests.get(t,this.customStyles.toParams())];case 1:return e=r.sent(),this.widgetService.loadSameOriginIFrame(e),[2]}}))}))},t.prototype.loadDunningPreview=function(){this.cq_demo("dunning")},t.prototype.loadDunningFromEmailLink=function(){var t=this.getDunningQueryParam();if(null===t)throw new Error("Cannot build the dunning form URL without any params");if(this.isDunningDemoQueryParam(t))this.loadDunningPreview();else{var e=this.get_param("at")||"",r=this.get_param("term_optimization_default")||"false",i=this.urlBuilder.buildDunningEmailFormUrl(t,e,r);this.loadDunning(i)}},t.prototype.loadDunningFromSmsLink=function(){var t=this.getPWQueryParam();if(null===t)throw new Error("Cannot build the dunning form URL without any params");if(this.isDunningDemoQueryParam(t))this.loadDunningPreview();else{var e=this.urlBuilder.buildDunningSmsFormUrl(t);this.loadDunning(e)}},t.prototype.loadDunningFromEncodedEmailLink=function(t){var e=t.term_optimization_default||!1,r=this.urlBuilder.buildDunningEmailFormUrl(t.uuid,t.email_number.toString(),e.toString());this.loadDunning(r)},t.prototype.getCustomerParams=function(){return this.customerIdentity.toParams()},t.prototype.triggerUserRequiredActions=function(){var t=this;setTimeout((function(){t.maybeFetchNotificationAndTrackCurrentUrl(),t.urlChangeListener.initialize((function(){t.urlTracker.maybeTrackCurrentUrl()}))}),0)},t.prototype.setUserId=function(t){this.customerIdentity.setUserId(t),this.urlTracker.reset(),this.triggerUserRequiredActions()},t.prototype.hasAnyPWQueryParam=function(){return this.hasDunningQueryParamFromEmail()||null!==this.getPWQueryParam()||this.hasAdHocQueryParams()},t.prototype.hasDunningQueryParamFromEmail=function(){return null!==this.getDunningQueryParam()},t.prototype.getDunningQueryParam=function(){return this.get_param("__pw_iic")},t.prototype.isDunningDemoQueryParam=function(t){return t.startsWith("tf-")},t.prototype.hasEncodedPWQueryParam=function(){return null!==this.getPWQueryParam()&&!this.hasDunningQueryParamFromSms()},t.prototype.hasAdHocQueryParams=function(){return B(this.getAdHocActivityTypeQueryParam())&&B(this.getAdHocCustomerIdQueryParam())},t.prototype.hasDunningQueryParamFromSms=function(){var t=this.getPWQueryParam();return null!==t&&t.length<20},t.prototype.getPWQueryParam=function(){return this.get_param("__pw")},t.prototype.getAdHocActivityTypeQueryParam=function(){return this.get_param("__pw_type")},t.prototype.getAdHocCustomerIdQueryParam=function(){return this.get_param("__pw_customer_id")},t.prototype.getActivityOrPreviewPayload=function(){var t=this.getPWQueryParam();return this.assertEncodedPWQueryParamCanBeParsed(),JSON.parse(atob(decodeURIComponent(t)))},t.prototype.assertEncodedPWQueryParamCanBeParsed=function(){if(!this.hasEncodedPWQueryParam())throw new Error("Cannot parse the activity payload without params");if(!window.atob)throw new Error("This link doesn't work on this browser. Please, try a different one.")},t.prototype.loadActivityOrPreview=function(){var t=this.getActivityOrPreviewPayload();!function(t){return"preview"in t&&t.preview}(t)?this.loadActivity(t):this.loadPreview(t)},t.prototype.loadPreview=function(t){var e=x(t.options,[]);this.cq_demo.apply(this,o([t.type],e))},t.prototype.loadActivity=function(t){var e=t.type,r=t.uuid;switch(e){case z.dunning:return void this.loadDunningFromEncodedEmailLink(t);case z.planUpgrade:case z.termOptimization:return void this.loadTermOptimization(r);case z.reactivation:return void this.loadReactivation(r);case z.extendTrial:return void this.loadExtendTrial(r);case z.reactivationUnsubscribe:return void this.loadReactivationUnsubscribe(r);case z.planUpgradeUnsubscribe:return void this.loadPlanUpgradeUnsubscribe(r);case z.updateCard:return void c('Widget goal "'+e+'" only supported for ad-hoc links.');default:m("Invalid widget goal value",e)}},t.prototype.loadAdHocActivity=function(){var t=this.getAdHocActivityTypeQueryParam(),e=this.getAdHocCustomerIdQueryParam();switch(L(e),t){case z.termOptimization:return void this.loadTermOptimizationAdHoc(e);case z.reactivation:return void this.loadReactivationAdHoc(e);case z.updateCard:return void this.loadUpdateCardAdHoc(e);default:this.send_error("Unknown ad hoc activity type: "+t)}},t.prototype.loadUpdateCardAdHoc=function(t){return i(this,void 0,void 0,(function(){var e,i,o;return n(this,(function(n){switch(n.label){case 0:return e=this.urlBuilder.buildCreditCardFormUrl(),i=r(r({},this.customStyles.toParams()),{user_id:t}),[4,this.requests.get(e,i)];case 1:return o=n.sent(),this.widgetService.loadSameOriginIFrame(o),[2]}}))}))},t.prototype.loadTermOptimization=function(t){return i(this,void 0,void 0,(function(){var e,r,i;return n(this,(function(n){switch(n.label){case 0:return e=this.customStyles.toString(),r=this.urlBuilder.buildTermOptimizationUrl(t,e),[4,this.requests.postUrlEncoded(r)];case 1:return i=n.sent(),this.widgetService.loadSameOriginIFrame(i),[2]}}))}))},t.prototype.loadTermOptimizationAdHoc=function(t){return i(this,void 0,void 0,(function(){var e,r,i;return n(this,(function(n){switch(n.label){case 0:return e=this.customStyles.toString(),r=this.urlBuilder.buildTermOptimizationAdHocUrl(t,e),[4,this.requests.postUrlEncoded(r)];case 1:return i=n.sent(),this.widgetService.loadSameOriginIFrame(i),[2]}}))}))},t.prototype.loadPlanUpgradeUnsubscribe=function(t){return i(this,void 0,void 0,(function(){var e,r;return n(this,(function(i){switch(i.label){case 0:return e=this.urlBuilder.buildPlanUpgradeUnsubscribe(t),[4,this.requests.postUrlEncoded(e,this.customStyles.toParams())];case 1:return r=i.sent(),this.widgetService.loadSameOriginIFrame(r),[2]}}))}))},t.prototype.loadReactivation=function(t){return i(this,void 0,void 0,(function(){var e,r;return n(this,(function(i){switch(i.label){case 0:return e=this.urlBuilder.buildReactivationUrl(t),[4,this.requests.get(e,this.customStyles.toParams())];case 1:return r=i.sent(),this.widgetService.loadSameOriginIFrame(r),[2]}}))}))},t.prototype.loadReactivationAdHoc=function(t){return i(this,void 0,void 0,(function(){var e,r;return n(this,(function(i){switch(i.label){case 0:return e=this.urlBuilder.buildReactivationAdHocUrl(t),[4,this.requests.get(e,this.customStyles.toParams())];case 1:return r=i.sent(),this.widgetService.loadSameOriginIFrame(r),[2]}}))}))},t.prototype.loadReactivationUnsubscribe=function(t){return i(this,void 0,void 0,(function(){var e,r;return n(this,(function(i){switch(i.label){case 0:return e=this.urlBuilder.buildReactivationUnsubscribe(t),[4,this.requests.postUrlEncoded(e,this.customStyles.toParams())];case 1:return r=i.sent(),this.widgetService.loadSameOriginIFrame(r),[2]}}))}))},t.prototype.loadExtendTrial=function(t){return i(this,void 0,void 0,(function(){var e,r;return n(this,(function(i){switch(i.label){case 0:return e=this.urlBuilder.buildExtendTrialUrl(t),[4,this.requests.postUrlEncoded(e,this.customStyles.toParams())];case 1:return r=i.sent(),this.widgetService.loadSameOriginIFrame(r),[2]}}))}))},t.prototype.digestAuthDataAttribute=function(t){var e=t.getAttribute("data-pw-auth");e&&this.setAuthToken(e)},t}(),$=function(){function t(){this.authToken=""}return t.prototype.setAuthToken=function(t){return this.isTokenValid(t)?(this.authToken=t,!0):(console.warn('Invalid token "'+t+'" attempted to be set'),!1)},t.prototype.getAuthToken=function(){return this.authToken},t.prototype.isAuthTokenValid=function(){return this.isTokenValid(this.authToken)},t.prototype.isTokenValid=function(t){return!V.authTokens.includes(t.toUpperCase())},t}(),G=function(){function t(){this.isEmailValid=!1,this.isUserIdValid=!1}return t.prototype.setEmail=function(t){this.email=t,this.isEmailValid=this.validateEmail()},t.prototype.setUserId=function(t){this.userId=t,this.isUserIdValid=this.validateUserId()},t.prototype.isValid=function(){return this.isEmailValid||this.isUserIdValid},t.prototype.toParams=function(){var t={};return this.isEmailValid&&(t.user_email=this.email),this.isUserIdValid&&(t.user_id=this.userId),t},t.prototype.validateEmail=function(){if(!this.email)return!1;var t=this.email.toLowerCase();return V.emails.every((function(e){return e!==t}))},t.prototype.validateUserId=function(){if(!this.userId)return!1;var t=String(this.userId).toLowerCase();return V.userIds.every((function(e){return e!==t}))},t}(),Y=function(){function t(){this.customStyles={}}return t.prototype.setCustomStyles=function(t){this.customStyles=t},t.prototype.getCustomStyles=function(){return this.customStyles},t.prototype.toString=function(){return JSON.stringify(this.customStyles)},t.prototype.toParams=function(){return{custom_styles:this.toString()}},t}();function Z(t){for(var e=[],r=1;r<arguments.length;r++)e[r-1]=arguments[r];var i=this[t];if("function"==typeof i)return i.apply(this,e)}var X=function(){function t(t){this.window=t}return t.prototype.addOneTimeListener=function(t,e){var r=this,i=function(n){var o=n.data;n.origin===r.window.origin&&B(o)&&o.type===t&&(r.window.removeEventListener("message",i),e(o.payload))};this.window.addEventListener("message",i)},t}(),tt=function(){function t(t,e){this.urlBuilder=t,this.requests=e}return t.prototype.fetchNotificationAndTrackCurrentUrl=function(t){return i(this,void 0,void 0,(function(){var e,r;return n(this,(function(i){switch(i.label){case 0:return e=this.urlBuilder.buildNotificationUrl(),[4,this.requests.get(e,t)];case 1:return""===(r=i.sent())?[2,{isEmpty:!0}]:[2,{isEmpty:!1,data:r}]}}))}))},t}(),et=function(){function t(t,e){this.retainUrl=t,this.sensingUrl=e}return t.buildSingleDomain=function(){return new t("https://www2.profitwell.com/","https://www2.profitwell.com/")},t.buildSplitDomains=function(){return new t("https://retain-api.profitwell.com/","https://api.profitwell-events.com/")},t.prototype.setRetainUrl=function(t){this.retainUrl=this.ensureTrailingSlash(t)},t.prototype.setSensingUrl=function(t){this.sensingUrl=this.ensureTrailingSlash(t)},t.prototype.getRetainUrl=function(){return this.retainUrl},t.prototype.getSensingUrl=function(){return this.sensingUrl},t.prototype.buildCreditCardFormUrl=function(){return this.buildDotJsUrl("generic-update-card/")},t.prototype.buildDunningEmailFormUrl=function(t,e,r){return this.buildDotJsUrl("pw/update-card/"+t)+"/"+("?at="+e+"&custom_url=true&term_optimization_default="+r)},t.prototype.buildDunningSmsFormUrl=function(t){return this.buildDotJsUrl("pw/update-card-sms/"+t)+"/?custom_url=true"},t.prototype.buildTermOptimizationUrl=function(t,e){return this.buildDotJsUrl("term-optimization/"+t+"/")+"?custom_styles="+e},t.prototype.buildTermOptimizationAdHocUrl=function(t,e){return this.buildDotJsUrl("term-optimization/ad-hoc/"+t+"/")+"?custom_styles="+e},t.prototype.buildTermOptimizationConfirmUpgradeUrl=function(t){return this.buildDotJsUrl("term-optimization/confirm-upgrade/"+t+"/")},t.prototype.buildPlanUpgradeUnsubscribe=function(t){return this.buildDotJsUrl("term-optimization/unsubscribe/"+t+"/")},t.prototype.buildReactivationUrl=function(t){return this.buildDotJsUrl("reactivation/"+t+"/")},t.prototype.buildReactivationAdHocUrl=function(t){return this.buildDotJsUrl("reactivation-ad-hoc/"+t+"/")},t.prototype.buildReactivationUnsubscribe=function(t){return this.buildDotJsUrl("unsubscribe-reactivation/"+t+"/")},t.prototype.buildExtendTrialUrl=function(t){return this.buildDotJsUrl("extend-trial/"+t+"/")},t.prototype.buildNotificationUrl=function(){return this.buildDotJsV1Url("quests/customer/")},t.prototype.buildHasOpenNotificationsUrl=function(){return this.buildDotJsV1Url("customer/has-notifications/")},t.prototype.buildFetchActiveNotificationUrl=function(){return this.buildDotJsV1Url("customer/active-notification/")},t.prototype.buildTrackingUrl=function(){return this.buildSensingUrl("customer/event/")},t.prototype.buildTrackAnonymousCustomerUrl=function(){return this.buildDotJsV1Url("anonymous/event/")},t.prototype.buildNotificationDemoUrl=function(){return this.buildDotJsV1Url("quests/demo/")},t.prototype.buildSendErrorUrl=function(){return this.buildDotJsV1Url("quests/error/")},t.prototype.buildCreateSalvageOfferUrl=function(){return this.buildDotJsUrl("create-salvage-offer/")},t.prototype.buildPreviewCancellationFlowUrl=function(){return this.buildDotJsUrl("cancellation-flow/preview/")},t.prototype.buildCancellationFlowUrl=function(){return this.buildDotJsUrl("cancellation-flow/")},t.prototype.ensureTrailingSlash=function(t){return"/"!==t.substr(-1)?t+"/":t},t.prototype.buildDotJsUrl=function(t){return this.retainUrl+"dotjs/"+t},t.prototype.buildDotJsV1Url=function(t){return this.retainUrl+"dotjs/v1/"+t},t.prototype.buildSensingUrl=function(t){return this.sensingUrl+"dotjs/v1/"+t},t}(),rt=function(){function t(){this.isEnabled=!1}return t.prototype.initialize=function(){},t.prototype.disable=function(){},t}(),it=function(){function t(t,e,r){this.requests=t,this.urlBuilder=e,this.customerIdentity=r,this.emptyUrl="",this.trackedUrl=this.emptyUrl}return t.prototype.maybeTrackCurrentUrl=function(){this.maybeSetCurrentUrlAsTracked()&&this.trackCurrentUrl()},t.prototype.maybeSetCurrentUrlAsTracked=function(){var t=window.location.href;return!(!this.customerIdentity.isValid()||this.trackedUrl===t)&&(this.trackedUrl=t,!0)},t.prototype.trackCurrentUrl=function(){var t,e=r(((t={})[F.docReferrer]=document.referrer,t),this.customerIdentity.toParams());this.requests.postJson(this.urlBuilder.buildTrackingUrl(),e)},t.prototype.reset=function(){this.trackedUrl=this.emptyUrl},t}(),nt=function(){function t(){this.iFrameId="__pw_frame"}return t.prototype.loadSameOriginIFrame=function(t,e){var r=this.createContentIFrame(),i=Q(r.contentDocument,"Error creating Profitwell iframe");void 0!==e&&r.addEventListener("load",(function(){var t=i.querySelector(".__pw_dotjs_content");null!==t&&t.addEventListener("__pw-cc-form-callback",e)}));var n=document.getElementById("profitwell-js");if(null!==n){var o=n.nonce||n.getAttribute("nonce")||"";t=t.replace(/verysecurenonce/g,o)}i.open(),i.write(t),i.close()},t.prototype.showFullScreen=function(){this.showIFrame({left:0,width:"100%",height:"100%"})},t.prototype.showNotification=function(t){var e={right:0,width:"390px",height:t};this.showIFrame(e)},t.prototype.hide=function(){var t=this.getContentIFrame();null!==t&&(t.style.display="none")},t.prototype.delete=function(){var t=this.getContentIFrame();null!==t&&t.remove()},t.prototype.createContentIFrame=function(){this.delete();var t=document.createElement("iframe");return t.id=this.iFrameId,t.style.border="0",t.style.width="0",t.style.height="0",document.body.appendChild(t),t},t.prototype.getBaseIFrameCSS=function(){return{"z-index":"2147483647",position:"fixed",top:0,border:0}},t.prototype.getContentIFrame=function(){return document.getElementById(this.iFrameId)},t.prototype.showIFrame=function(t){var e=r(r(r({},this.getBaseIFrameCSS()),t),{display:"unset"}),i=this.getContentIFrame();if(null!==i)for(var n in e)i.style.setProperty(n,e[n])},t}(),ot=et.buildSingleDomain(),st=new $,at=new W(st),ut=new G;!function(t){var e=window;if(e.profitwell.isLoaded)e.profitwell("digestScriptDataAttributes");else{t.digestScriptDataAttributes();for(var r=Z.bind(t),i=window.profitwell.q||[];i.length>0;){var n=Array.from(i.shift()),s=n[0],a=n.slice(1);Z.call.apply(Z,o([t,s],a))}e.profitwell=r,r.isLoaded=!0,t.on_load()}}(new M(ot,st,at,ut,new it(at,ot,ut),new t,new rt,new nt,new Y,new tt(ot,at),new X(window)))}();
